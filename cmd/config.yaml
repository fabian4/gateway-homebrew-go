entrypoint:
  - name: web
    address: ":18080"
  # - name: mysql-proxy
  #   address: ":13306"
  #   service: mysql-cluster

# tls:
#   enabled: true
#   # ALPN is automatically enabled (h2, http/1.1) if TLS is active.
#   certificates:
#     - cert_file: "./certs/example.com.crt"
#       key_file: "./certs/example.com.key"
#     - cert_file: "./certs/other.com.crt"
#       key_file: "./certs/other.com.key"

timeouts:
  read: 15s
  write: 30s
  upstream: 10s
  tcp_idle: 5m
  tcp_connection: 0s # unlimited

services:
  - name: api-v1
    proto: http1
    endpoints:
      - "http://127.0.0.1:19001"   # used for /api/v1
  - name: api-root
    proto: http1
    endpoints:
      - "http://127.0.0.1:19002"   # used for /api
  - name: wildcard-subdomains
    proto: http1
    endpoints:
      - "http://127.0.0.1:19003"   # used for *.example.com
  - name: global-default
    proto: http1
    endpoints:
      - "http://127.0.0.1:19004"   # used as global fallback
  - name: backend-weighted
    proto: http1
    endpoints:
      - { url: "http://127.0.0.1:19001", weight: 3 }
      - { url: "http://127.0.0.1:19002", weight: 1 }
  # - name: mysql-cluster
  #   proto: tcp
  #   endpoints:
  #     - "tcp://127.0.0.1:3306"

  # - name: grpc-service
  #   proto: auto  # use 'auto' for TLS upstream (h2) or 'http1' for standard proxy
  #   endpoints:
  #     - "https://grpc.example.com:443"
  #   tls:
  #     ca_file: "./certs/ca.crt"
  #     cert_file: "./certs/client.crt"
  #     key_file: "./certs/client.key"

routes:
  # exact host + more specific prefix
  - name: api-v1
    match:
      host: "app.example.com"
      path_prefix: "/api/v1"
    service: api-v1

  # exact host default under /api
  - name: api-root
    match:
      host: "app.example.com"
      path_prefix: "/api"
    service: api-root

  # per-host default for app.example.com
  - name: app-default
    match:
      host: "app.example.com"
      path_prefix: "/"
    service: api-root

  # wildcard host for any subdomain of example.com (not example.com itself)
  - name: subdomains-example
    match:
      host: "*.example.com"
      path_prefix: "/"
    service: wildcard-subdomains

  # global default for all other hosts
  - name: global-default
    match:
      host: ""
      path_prefix: "/"
    service: global-default

  # weighted load balancing example
  - name: weighted-demo
    match:
      host: "lb.example.com"
      path_prefix: "/"
    service: backend-weighted

  # gRPC example
  # - name: grpc-route
  #   match:
  #     host: "grpc.example.com"
  #     path_prefix: "/"
  #   service: grpc-service
