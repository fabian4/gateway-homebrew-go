services:
  gateway:
    build:
      context: ../..
      dockerfile: Dockerfile
    image: gateway-homebrew-go:local
    container_name: e2e-gateway
    ports:
      - "18080:8080"
      - "19000:9000"
    volumes:
      - ../config/config.e2e.yaml:/etc/gateway/config.yaml:ro
    depends_on:
      - u1
      - u2
      - tcp-echo

  u1:
    build:
      context: ../..
      dockerfile: test/dockerfile/echo.Dockerfile
      args:
        PKG: ./examples/upstreams/http-echo
    container_name: e2e-u1
    environment:
      - ECHO_ADDR=:9001
      - ECHO_ID=u1
    expose:
      - "9001"

  u2:
    build:
      context: ../..
      dockerfile: test/dockerfile/echo.Dockerfile
      args:
        PKG: ./examples/upstreams/http-echo
    container_name: e2e-u2
    environment:
      - ECHO_ADDR=:9002
      - ECHO_ID=u2
    expose:
      - "9002"

  tcp-echo:
    build:
      context: ../..
      dockerfile: test/dockerfile/echo.Dockerfile
      args:
        PKG: ./examples/upstreams/tcp-echo
    container_name: e2e-tcp
    environment:
      - TCP_ECHO_ADDR=:9003
      - TCP_ECHO_GREETING=hello-tcp
    expose:
      - "9003"
