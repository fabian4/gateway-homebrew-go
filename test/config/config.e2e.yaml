entrypoint:
  - name: web
    address: ":8080"
  - name: tcp-proxy
    address: ":9000"
    service: tcp-echo

metrics:
  address: ":9090"

access_log:
  sampling: 1.0
  fields: ["time", "method", "path", "status", "duration_ms", "upstream", "service", "bytes_written"]

transport:
  max_idle_conns: 100
  max_idle_conns_per_host: 10
  idle_conn_timeout: 30s

benchmark:
  enabled: false

timeouts:
  read: 5s
  write: 5s
  upstream: 500ms
  tcp_idle: 5m
  tcp_connection: 1h

services:
  - name: u1
    proto: http1
    endpoints:
      - "http://u1:9001"
  - name: u2
    proto: http1
    endpoints:
      - "http://u2:9002"

  - name: u-lb
    proto: http1
    endpoints:
      - { url: "http://u1:9001", weight: 3 }
      - { url: "http://u2:9002", weight: 1 }

  - name: tcp-echo
    proto: tcp
    endpoints:
      - "tcp://tcp-echo:9003"

routes:
  - name: r-v1
    match:
      host: "app.example.com"
      path_prefix: "/api/v1"
    service: u2

  - name: r-api
    match:
      host: "app.example.com"
      path_prefix: "/api"
    service: u1

  - name: r-lb
    match:
      host: "lb.local"
      path_prefix: "/"
    service: u-lb

  # wildcard â†’ u1, so /healthz works for any Host
  - name: r-any
    match:
      path_prefix: "/"
    service: u1
